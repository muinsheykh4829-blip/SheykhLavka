<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API - Sheykh Lavka</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin-bottom: 30px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; white-space: pre-wrap; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API - Sheykh Lavka</h1>
    
    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div class="section">
        <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <form id="registerForm">
            <div class="form-group">
                <label>–ò–º—è:</label>
                <input type="text" id="reg_name" value="–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" required>
            </div>
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="reg_phone" value="+998901234567" required>
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="reg_password" value="123456" required>
            </div>
            <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <div id="registerResult" class="result" style="display:none;"></div>
    </div>

    <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞ -->
    <div class="section">
        <h2>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞</h2>
        <form id="verifyForm">
            <div class="form-group">
                <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="user_id" placeholder="–ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" required>
            </div>
            <div class="form-group">
                <label>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</label>
                <input type="text" id="verify_code" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥" required>
            </div>
            <button type="submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
        </form>
        <div id="verifyResult" class="result" style="display:none;"></div>
    </div>

    <!-- –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É -->
    <div class="section">
        <h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <form id="loginForm">
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="login_phone" value="+998901234567" required>
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="login_password" value="123456" required>
            </div>
            <button type="submit">–í–æ–π—Ç–∏</button>
        </form>
        <div id="loginResult" class="result" style="display:none;"></div>
    </div>

    <!-- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="section">
        <h2>üë§ –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <form id="profileForm">
            <div class="form-group">
                <label>API Token:</label>
                <input type="text" id="api_token" placeholder="–ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞" required>
            </div>
            <button type="submit">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        </form>
        <div id="profileResult" class="result" style="display:none;"></div>
    </div>

    <!-- –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã -->
    <div class="section">
        <h2>üö™ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</h2>
        <form id="logoutForm">
            <div class="form-group">
                <label>API Token:</label>
                <input type="text" id="logout_token" placeholder="–í–∞—à —Ç–æ–∫–µ–Ω" required>
            </div>
            <button type="submit">–í—ã–π—Ç–∏</button>
        </form>
        <div id="logoutResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000/api/v1';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { response, data };
            } catch (error) {
                return { error: error.message };
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const { response, data, error } = await makeRequest(`${API_BASE}/auth/register`, {
                method: 'POST',
                body: JSON.stringify({
                    name: document.getElementById('reg_name').value,
                    phone: document.getElementById('reg_phone').value,
                    password: document.getElementById('reg_password').value,
                })
            });

            const resultDiv = document.getElementById('registerResult');
            resultDiv.style.display = 'block';
            
            if (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${error}`;
            } else {
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `–£—Å–ø–µ—Ö! User ID: ${data.data.user_id}\n–ö–æ–¥: ${data.data.verification_code}`;
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
                    document.getElementById('user_id').value = data.data.user_id;
                    document.getElementById('verify_code').value = data.data.verification_code;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                }
            }
        });

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞
        document.getElementById('verifyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const { response, data, error } = await makeRequest(`${API_BASE}/auth/verify-code`, {
                method: 'POST',
                body: JSON.stringify({
                    user_id: document.getElementById('user_id').value,
                    code: document.getElementById('verify_code').value,
                })
            });

            const resultDiv = document.getElementById('verifyResult');
            resultDiv.style.display = 'block';
            
            if (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${error}`;
            } else {
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `–£—Å–ø–µ—Ö! –¢–æ–∫–µ–Ω: ${data.data.token}`;
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                    document.getElementById('api_token').value = data.data.token;
                    document.getElementById('logout_token').value = data.data.token;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                }
            }
        });

        // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const { response, data, error } = await makeRequest(`${API_BASE}/auth/login`, {
                method: 'POST',
                body: JSON.stringify({
                    phone: document.getElementById('login_phone').value,
                    password: document.getElementById('login_password').value,
                })
            });

            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            
            if (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${error}`;
            } else {
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `–£—Å–ø–µ—Ö! –¢–æ–∫–µ–Ω: ${data.data.token}`;
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                    document.getElementById('api_token').value = data.data.token;
                    document.getElementById('logout_token').value = data.data.token;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                }
            }
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = document.getElementById('api_token').value;
            const { response, data, error } = await makeRequest(`${API_BASE}/user`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            const resultDiv = document.getElementById('profileResult');
            resultDiv.style.display = 'block';
            
            if (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${error}`;
            } else {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(data, null, 2);
            }
        });

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        document.getElementById('logoutForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = document.getElementById('logout_token').value;
            const { response, data, error } = await makeRequest(`${API_BASE}/auth/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            const resultDiv = document.getElementById('logoutResult');
            resultDiv.style.display = 'block';
            
            if (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${error}`;
            } else {
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã!';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                }
            }
        });
    </script>
</body>
</html>
