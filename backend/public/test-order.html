<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        button { margin: 5px; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üõí –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</h1>
    
    <button onclick="createTestOrder()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
    <button onclick="window.open('/admin/orders', '_blank')">–û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
    
    <div id="results"></div>

    <script>
    async function createTestOrder() {
        const resultDiv = document.getElementById('results');
        
        try {
            console.log('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞...');
            
            const orderData = {
                delivery_address: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è 123',
                delivery_phone: '+992000000001',
                delivery_name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                payment_method: 'cash',
                comment: '–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å',
                items: [
                    {
                        product_id: 2, // ID —Ç–æ–≤–∞—Ä–∞ "–Ø–±–ª–æ–∫–∏"
                        quantity: 3
                    }
                ]
            };
            
            // –ü–æ–ø—Ä–æ–±—É–µ–º –æ–±–∞ –º–∞—Ä—à—Ä—É—Ç–∞
            let response, result;
            
            try {
                console.log('–ü—Ä–æ–±—É–µ–º –º–∞—Ä—à—Ä—É—Ç /orders/create...');
                response = await fetch('http://localhost:8000/api/v1/orders/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(orderData)
                });
                result = await response.text();
            } catch (e1) {
                console.log('–û—à–∏–±–∫–∞ —Å /orders/create:', e1.message);
                console.log('–ü—Ä–æ–±—É–µ–º –º–∞—Ä—à—Ä—É—Ç /orders...');
                response = await fetch('http://localhost:8000/api/v1/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(orderData)
                });
                result = await response.text();
            }
            
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
            
            let parsedResult;
            try {
                parsedResult = JSON.parse(result);
            } catch {
                parsedResult = { message: result };
            }
            
            const resultHtml = `
                <div class="test-result ${response.ok ? 'success' : 'error'}">
                    <h3>üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</h3>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>–£—Å–ø–µ—Ö:</strong> ${parsedResult.success ? '–î–∞' : '–ù–µ—Ç'}</p>
                    ${parsedResult.order ? `<p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> ${parsedResult.order.order_number}</p>` : ''}
                    ${parsedResult.message ? `<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${parsedResult.message}</p>` : ''}
                    <p><strong>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong></p>
                    <pre>${JSON.stringify(parsedResult, null, 2)}</pre>
                </div>
            `;
            resultDiv.innerHTML = resultHtml + resultDiv.innerHTML;
            
            if (response.ok && parsedResult.success) {
                alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –ù–æ–º–µ—Ä: ' + parsedResult.order.order_number);
            }
            
        } catch (error) {
            const result = `
                <div class="test-result error">
                    <h3>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</h3>
                    <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                </div>
            `;
            resultDiv.innerHTML = result + resultDiv.innerHTML;
        }
    }
    </script>
</body>
</html>
