<!DOCTYPE html>
<html>
<head>
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .success { color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin: 10px 0; }
        .error { color: red; padding: 10px; background: #f8d7da; border-radius: 5px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .result { margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite</h1>
        
        <div class="result" id="result"></div>
        
        <button class="btn" onclick="createTables()">üî® –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
        <button class="btn" onclick="checkTables()">üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
        <button class="btn" onclick="createTestData()">üì¶ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button class="btn" onclick="testAdmin()">üë®‚Äçüíº –¢–µ—Å—Ç –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏</button>
    </div>

    <script>
        async function createTables() {
            showLoading();
            try {
                const response = await fetch('/create-db-tables', { 
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                
                const text = await response.text();
                console.log('Response text:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: '–û—Ç–≤–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è JSON', response: text };
                }
                
                showResult(data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({ error: error.message }, 'error');
            }
        }
        
        async function checkTables() {
            showLoading();
            try {
                const response = await fetch('/test-json', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                console.log('Check tables response status:', response.status);
                
                const text = await response.text();
                console.log('Check tables response text:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: '–û—Ç–≤–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è JSON', response: text };
                }
                
                showResult(data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({ error: error.message }, 'error');
            }
        }
        
        async function createTestData() {
            showLoading();
            try {
                const response = await fetch('/create-test-data', { 
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const text = await response.text();
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { error: '–û—Ç–≤–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è JSON', response: text };
                }
                
                showResult(data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({ error: error.message }, 'error');
            }
        }
        
        async function testAdmin() {
            showLoading();
            window.open('/admin/categories', '_blank');
            showResult({ message: '–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ' }, 'success');
        }
        
        function showLoading() {
            document.getElementById('result').innerHTML = '<div class="success">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        }
        
        function showResult(data, type) {
            const resultDiv = document.getElementById('result');
            const className = type === 'success' ? 'success' : 'error';
            
            let content = `<div class="${className}">`;
            if (data.status === 'success' || type === 'success') {
                content += '‚úÖ ' + (data.message || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                if (data.tables) {
                    content += '<br><strong>–¢–∞–±–ª–∏—Ü—ã:</strong><br>';
                    data.tables.forEach(table => {
                        content += `- ${table.name}<br>`;
                    });
                }
                if (data.users || data.categories || data.products) {
                    content += '<br><strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br>';
                    if (data.users) content += `- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${data.users}<br>`;
                    if (data.categories) content += `- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: ${data.categories}<br>`;
                    if (data.products) content += `- –ü—Ä–æ–¥—É–∫—Ç—ã: ${data.products}<br>`;
                }
            } else {
                content += '‚ùå ' + (data.message || data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
            }
            content += '</div>';
            
            if (typeof data === 'object' && Object.keys(data).length > 0) {
                content += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            }
            
            resultDiv.innerHTML = content;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkTables;
    </script>
</body>
</html>
