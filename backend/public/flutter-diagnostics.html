<!DOCTYPE html>
<html>
<head>
    <title>Flutter API –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .success { color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin: 10px 0; }
        .error { color: red; padding: 10px; background: #f8d7da; border-radius: 5px; margin: 10px 0; }
        .info { color: blue; padding: 10px; background: #d1ecf1; border-radius: 5px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .result { margin: 20px 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Flutter API –ü–æ–ª–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
        
        <div class="info">
            <h3>üìã –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:</h3>
            <ul>
                <li><strong>Laravel —Å–µ—Ä–≤–µ—Ä:</strong> http://localhost:8000</li>
                <li><strong>API –±–∞–∑–æ–≤—ã–π URL:</strong> http://10.0.2.2:8000/api/v1</li>
                <li><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> SQLite</li>
            </ul>
        </div>
        
        <div class="grid">
            <div>
                <h3>üñ•Ô∏è –°–µ—Ä–≤–µ—Ä</h3>
                <button class="btn" onclick="testServer()">–¢–µ—Å—Ç Laravel</button>
                <button class="btn" onclick="testDatabase()">–¢–µ—Å—Ç –ë–î</button>
                <button class="btn" onclick="createTables()">–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
                <button class="btn" onclick="createData()">–°–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            <div>
                <h3>üì± API</h3>
                <button class="btn" onclick="testAPIConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
                <button class="btn" onclick="testCategories()">–¢–µ—Å—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</button>
                <button class="btn" onclick="testProducts()">–¢–µ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤</button>
                <button class="btn" onclick="testAuth()">–¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</button>
            </div>
        </div>
        
        <div class="result" id="result"></div>
    </div>

    <script>
        // –†–∞–∑–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const serverUrl = 'http://localhost:8000';
        const apiUrl = 'http://localhost:8000/api/v1';
        const flutterApiUrl = 'http://10.0.2.2:8000/api/v1';
        
        async function testServer() {
            showLoading('–ü—Ä–æ–≤–µ—Ä—è–µ–º Laravel —Å–µ—Ä–≤–µ—Ä...');
            try {
                const response = await fetch(`${serverUrl}/test-json`);
                const data = await response.json();
                showResult({
                    test: 'Laravel Server',
                    status: 'success',
                    data: data
                }, 'success');
            } catch (error) {
                showResult({
                    test: 'Laravel Server',
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function testDatabase() {
            showLoading('–ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');
            try {
                const response = await fetch(`${serverUrl}/test-db`);
                const data = await response.json();
                showResult({
                    test: 'Database Connection',
                    status: data.status === 'success' ? 'success' : 'error',
                    data: data
                }, data.status === 'success' ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Database Connection',
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function createTables() {
            showLoading('–°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã...');
            try {
                const response = await fetch(`${serverUrl}/create-db-tables`);
                const data = await response.json();
                showResult({
                    test: 'Create Tables',
                    status: data.status === 'success' ? 'success' : 'error',
                    data: data
                }, data.status === 'success' ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Create Tables',
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function createData() {
            showLoading('–°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
            try {
                const response = await fetch(`${serverUrl}/create-test-data`);
                const data = await response.json();
                showResult({
                    test: 'Create Test Data',
                    status: data.status === 'success' ? 'success' : 'error',
                    data: data
                }, data.status === 'success' ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Create Test Data',
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function testAPIConnection() {
            showLoading('–¢–µ—Å—Ç–∏—Ä—É–µ–º API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
            try {
                const response = await fetch(`${apiUrl}/test`);
                const data = await response.json();
                showResult({
                    test: 'API Connection',
                    url: `${apiUrl}/test`,
                    status: 'success',
                    data: data
                }, 'success');
            } catch (error) {
                showResult({
                    test: 'API Connection',
                    url: `${apiUrl}/test`,
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function testCategories() {
            showLoading('–¢–µ—Å—Ç–∏—Ä—É–µ–º API –∫–∞—Ç–µ–≥–æ—Ä–∏–π...');
            try {
                const response = await fetch(`${apiUrl}/categories`);
                const data = await response.json();
                showResult({
                    test: 'Categories API',
                    url: `${apiUrl}/categories`,
                    status: data.success ? 'success' : 'error',
                    data: data
                }, data.success ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Categories API',
                    url: `${apiUrl}/categories`,
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function testProducts() {
            showLoading('–¢–µ—Å—Ç–∏—Ä—É–µ–º API –ø—Ä–æ–¥—É–∫—Ç–æ–≤...');
            try {
                const response = await fetch(`${apiUrl}/products`);
                const data = await response.json();
                showResult({
                    test: 'Products API',
                    url: `${apiUrl}/products`,
                    status: data.success ? 'success' : 'error',
                    data: data
                }, data.success ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Products API',
                    url: `${apiUrl}/products`,
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        async function testAuth() {
            showLoading('–¢–µ—Å—Ç–∏—Ä—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...');
            try {
                const response = await fetch(`${apiUrl}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: '+992987654321',
                        name: 'Test User',
                        password: 'password123'
                    })
                });
                const data = await response.json();
                showResult({
                    test: 'Authentication API',
                    url: `${apiUrl}/auth/register`,
                    status: response.ok ? 'success' : 'error',
                    data: data
                }, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({
                    test: 'Authentication API',
                    url: `${apiUrl}/auth/register`,
                    status: 'error',
                    error: error.message
                }, 'error');
            }
        }
        
        function showLoading(message) {
            document.getElementById('result').innerHTML = `<div class="info">‚è≥ ${message}</div>`;
        }
        
        function showResult(data, type) {
            const resultDiv = document.getElementById('result');
            let className = type === 'success' ? 'success' : 'error';
            
            let content = `<div class="${className}">`;
            if (type === 'success') {
                content += `‚úÖ ${data.test || '–¢–µ—Å—Ç'} - –£—Å–ø–µ—à–Ω–æ`;
            } else {
                content += `‚ùå ${data.test || '–¢–µ—Å—Ç'} - –û—à–∏–±–∫–∞`;
                if (data.error) {
                    content += `<br><strong>–û—à–∏–±–∫–∞:</strong> ${data.error}`;
                }
            }
            if (data.url) {
                content += `<br><strong>URL:</strong> ${data.url}`;
            }
            content += '</div>';
            
            if (data.data) {
                content += '<pre>' + JSON.stringify(data.data, null, 2) + '</pre>';
            }
            
            resultDiv.innerHTML = content;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            testServer();
        };
    </script>
</body>
</html>
